# Modern Chat - 现代化聊天系统-V2.1.20

一个基于 PHP + MySQL + HTML 的现代化聊天系统，具有现代化的 UI 设计和丰富的功能。

<p>
  <a href="https://github.com/LzdqesjG/modern-chat/stargazers" target="_blank">
    <img alt="GitHub stars" src="https://img.shields.io/github/stars/LzdqesjG/modern-chat.svg" />
  </a>
  <a href="https://github.com/LzdqesjG/modern-chat/releases" target="_blank">
    <img alt="All releases" src="https://img.shields.io/github/downloads/LzdqesjG/modern-chat/total.svg" />
  </a>
</p>

点击链接加入QQ群聊【网页聊天室用户交流群】：(https://qm.qq.com/q/gn6F4IeCOY)[https://qm.qq.com/q/gn6F4IeCOY]

若无法加群请使用QQ群号：`1075419361`

---

   ### 已部署好的体验网站

  - https://chat.hyacine.com.cn/chat
  - 如果觉得项目好可以向开发者赞助（自愿）
  - wx:
    <p>
    <img src="https://www.varesa.top/wallpapers/1770705339865.png"/>
    </p>
  - zfb:
    <p>
    <img src="https://www.varesa.top/wallpapers/177070538832.jpg" />
    </p>
---

<p>
  <a href="https://github.com/LzdqesjG/modern-chat/releases/latest" target="_blank">
    <img alt="Latest GitHub release" src="https://img.shields.io/github/release/LzdqesjG/modern-chat.svg" />
  </a>
  <a href="https://github.com/LzdqesjG/modern-chat/wiki/Help" target="_blank">
    <img alt="Documentation WIP" src="https://img.shields.io/badge/Docs-WIP-red.svg" />
  </a>
  <a href="https://github.com/LzdqesjG/modern-chat/issues" target="_blank">
    <img alt="Issues" src="https://img.shields.io/github/issues/LzdqesjG/modern-chat.svg" />
  </a>
  <a style="text-decoration:none" href="https://discord.gg/XgEqDHX">
    <img src="https://img.shields.io/discord/1456213145139019893.svg" alt="Discord" />
  </a>
</p>


## 功能特性

- 📱 **现代化 UI 设计** - 响应式设计，适配各种设备
- 👥 **安装引导** - 简单易使用
- 🔐 **用户认证** - 安全的注册和登录系统
- 👥 **好友管理** - 添加好友、接受请求、查看好友列表
- 💬 **实时聊天** - 发送文本消息和文件
- 📎 **文件传输** - 支持发送小于 150MB（可修改） 的文件
- 🟢 **在线状态** - 显示好友是否在线
- 🔍 **好友搜索** - 快速查找好友
- 📱 **响应式设计** - 适配移动端和桌面端
- 📝 **反馈系统** - 用户可以提交反馈，管理员可以查看和管理反馈
- 🔔 **反馈通知** - 用户提交的反馈被处理后会收到通知
- 👥 **群聊功能** - 支持创建群聊、邀请好友加入群聊
- 📨 **群聊邀请** - 支持邀请好友加入群聊，包含审批流程
- ⏳ **入群申请** - 普通成员邀请的好友需要管理员或群主审批才能入群
- 🔒 **封禁系统** - 管理员可以封禁用户，被封禁用户无法登录和使用系统
- 👨‍💼 **自动添加管理员好友** - 用户注册后自动添加Admin管理员为好友并自动通过，方便管理员沟通和管理
- ⏱️ **会话时长配置** - 支持配置用户会话时长，默认为1小时，可在config.json或管理后台修改
- ⏪ **消息撤回** - 支持撤回2分钟内的消息和文件，撤回后显示撤回提示
- ✏️ **重新编辑** - 撤回消息后可点击"重新编辑"按钮重新编辑消息
- 🗑️ **文件撤回** - 撤回消息时自动删除服务器上的对应文件
- 📱 **移动端支持** - 独立的移动端聊天页面，优化移动端体验
- 👥 **移动端好友管理** - 移动端支持查看好友申请、同意/拒绝好友申请
- 💬 **移动端聊天菜单** - 移动端聊天页面支持好友和群聊的操作菜单
- 👥 **移动端群成员操作** - 移动端群成员列表支持向成员发送好友申请
- 🗑️ **移动端删除好友** - 移动端支持删除好友功能
- 📨 **移动端群聊操作** - 移动端支持查看群成员和退出群聊功能
- 🎵 **音乐播放器** - 内置音乐播放器，支持随机播放歌曲
- 📱 **电脑端音乐播放器** - 电脑端支持音乐播放器功能
- 🎛️ **音量控制** - 支持调节音量大小
- 🎮 **播放控制** - 支持播放/暂停、上一首、下一首
- 📥 **音乐下载** - 支持下载当前播放的歌曲
- ⚙️ **可配置** - 支持在config.json中配置是否启用随机播放功能
- 📊 **在线用户计数** - 使用Redis显示当前网站在线用户数量
- ⚡ **Service Worker加速** - 支持缓存静态资源和用户头像，提升加载速度
- 🌍 **世界大厅** - 自动创建的全员群聊，命名为"世界大厅-{编号}"
- 🔄 **在线更新系统** - 管理员可以通过网页端在线更新系统，自动下载并安装更新

## 技术栈

- **前端**: HTML5, CSS3, JavaScript
- **后端**: PHP 7.4+
- **数据库**: MySQL 5.7+
- **数据库驱动**: PDO
- **缓存**: Redis (用于在线用户计数)
## config.json 配置文件

在config目录下，您需要修改一个 `config.json` 文件，用于存储聊天系统的配置信息和其他配置。以下是一个示例配置文件：

```json
{
    "Create_a_group_chat_for_all_members": true,
    "Restrict_registration": true, 
    "Restrict_registration_ip": 3, 
    "ban_system": true, 
    "user_name_max": 12,
    "upload_files_max": 150,
    "Session_Duration": 1,
    "email_verify": true,
    "email_verify_api": "https:\/\/api.nbhao.org\/v1\/email\/verify",
    "email_verify_api_Request": "POST",
    "email_verify_api_Verify_parameters": "message.result",
    "Random_song": false
}
```

- `Create_a_group_chat_for_all_members`: 你希望用户注册后自动创建一个群聊，群聊名称为"世界大厅-{编号}"，例如：世界大厅-1.
- `Restrict_registration`: 是否限制注册（如果配置了这个必须配置下面的Restrict_registration_ip的数量）.
- `Restrict_registration_ip`: 你希望一个IP地址最多注册几个账号.
- `user_name_max`: 你希望最大设置的用户名长度.
- `ban_system`: 是否启用封禁系统.
- `upload_files_max`: 你希望用户最大可发送的文件大小（MB）.
- `Session_Duration`: 用户会话时长（小时），默认1小时.
- `email_verify`: 是否启用邮箱验证.
- `email_verify_api`: 邮箱验证 API 地址.
- `email_verify_api_Request`: 邮箱验证 API 请求方法（GET 或 POST）.
- `email_verify_api_Verify_parameters`: 邮箱验证 API 返回结果参数名（例如："message.result"）.
- `Random_song`: 是否启用随机播放歌曲功能，true为启用，false为禁用.

请根据您的实际配置修改这些值。

## 安装步骤

### 方式一：图形化安装向导（推荐）

#### 1. 克隆或下载项目

将项目文件下载到您的 web 服务器目录中。

#### 2. 配置目录权限

确保以下目录具有写入权限：

```bash
chmod -R 777 avatars/ uploads/ config/
```

#### 3. 访问安装向导

使用浏览器访问：http://`{您的域名或IP地址}`/install.php

#### 4. 按照向导完成配置

安装向导会引导您完成以下步骤：

1. **欢迎页面** - 了解系统信息和安装流程
2. **环境检测** - 自动检测 PHP 版本、扩展和目录权限
3. **数据库配置** - 填写数据库连接信息，系统会自动创建数据库和导入数据表
4. **完成安装** - 安装成功后，首次注册的用户将自动成为超级管理员

详细说明请参考 [install/README.md](install/README.md)

### 方式二：传统部署（Apache/Nginx + PHP + MySQL）

如果您熟悉手动配置，也可以使用传统部署方式。

#### 1. 克隆或下载项目

将项目文件下载到您的 web 服务器目录中。

#### 2. 创建数据库

使用 MySQL 客户端执行 `db.sql` 文件来创建数据库和基础表：

```bash
mysql -u root -p < db.sql
```
or 在 phpMyAdmin 中导入 `db.sql` 文件。

#### 3. 配置数据库连接

编辑 `config.php` 文件，配置您的数据库连接信息：

```php
define('DB_HOST', 'localhost');
define('DB_NAME', 'chat');
define('DB_USER', 'root');
define('DB_PASS', 'your_password');
```

#### 4. 配置文件上传

确保 `uploads/` 目录具有写入权限：

```bash
chmod 777 uploads/
```
#### 5. 解锁网页

删除网站目录下的lock文件并正式解锁 web 服务器。

#### 6. 启动 web 服务器

使用 Apache 或 Nginx 启动您的 web 服务器，然后访问项目目录。

### Docker 部署

#### 1. 克隆或下载项目

将项目文件下载到您的服务器目录中。

#### 2. 解锁网页

删除网站目录下的lock文件并正式解锁 web 服务器。

#### 3. 创建 .env 文件

在项目根目录下创建 `.env` 文件，用于配置 Docker 部署的环境变量：

```bash
touch .env
```

编辑 `.env` 文件，添加以下配置（根据您的实际需求修改）：

```dotenv
# 数据库密码
DB_PASSWORD=rootpassword

# HTTP 端口，默认 80
HTTP_PORT=80

# HTTPS 端口，默认 443
HTTPS_PORT=443

# phpMyAdmin 端口，默认 888
PHPMYADMIN_PORT=888
```

#### 4. 启动 Docker 容器

在项目根目录下执行以下命令启动 Docker 容器：

```bash
docker-compose up -d
```

#### 5. 访问应用

- 聊天系统：`http://your-server-ip:HTTP_PORT/`
- phpMyAdmin：`http://your-server-ip:PHPMYADMIN_PORT`

#### 6. 停止 Docker 容器

在项目根目录下执行以下命令停止 Docker 容器：

```bash
docker-compose down
```

#### 7. 查看 Docker 容器状态

```bash
docker-compose ps
```

#### 8. 查看 Docker 容器日志

```bash
docker-compose logs
```

#### 9. 重启 Docker 容器

```bash
docker-compose restart
```

## 使用说明

### 1. 注册账户

访问 `register.php` 页面，填写用户名、邮箱和密码进行注册。（若使用方式一安装请忽略）
注：如果您是方式二安装的请在首次注册一个Admin管理员账号，后续用户注册请使用普通用户名注册。

### 2. 登录系统

访问 `login.php` 页面，使用注册的邮箱和密码登录。

### 3. 添加好友

在聊天页面的搜索栏中输入好友的用户名，发送好友请求。

### 4. 开始聊天

在好友列表中选择一个好友，开始发送消息和文件。

### 5. 提交反馈

1. 在聊天页面点击右上角的三个点图标，选择"反馈问题"
2. 在弹出的反馈表单中输入您的问题描述
3. （可选）上传相关的图片
4. 点击"提交反馈"按钮

### 6. 管理反馈（管理员）

1. 登录管理员账户
2. 在管理页面点击"反馈管理"标签
3. 查看所有用户提交的反馈
4. 点击"反馈已收到"按钮标记反馈为已处理
5. （可选）点击"删除反馈"按钮删除反馈

### 7. 创建和使用群聊

1. 在聊天页面点击"建立群聊"按钮
2. 输入群聊名称
3. 选择要邀请的好友
4. 点击"创建群聊"按钮

### 8. 邀请好友加入群聊

1. 在群聊页面点击右上角的三个点图标
2. 选择"邀请好友"选项
3. 在弹出的好友列表中选择要邀请的好友
4. 点击"邀请"按钮发送邀请

### 9. 处理群聊邀请

- 当您收到群聊邀请时，系统会在右上角显示通知
- 点击"接受"按钮接受邀请，或者点击"拒绝"按钮拒绝邀请
- 如果邀请您的用户是管理员或群主，您会直接加入群聊
- 如果邀请您的用户不是管理员或群主，您的入群申请会发送给管理员或群主审批

### 10. 查看和处理入群申请（管理员/群主）

1. 作为管理员或群主，您会收到入群申请通知
2. 点击"批准"按钮批准申请，或者点击"拒绝"按钮拒绝申请
3. 被批准的用户会直接加入群聊
4. 被拒绝的用户不会加入群聊

### 11. 查看反馈通知

- 当您提交的反馈被管理员标记为已收到时，您下次登录系统会收到通知
- 通知会显示在聊天页面的右上角，点击关闭按钮即可关闭通知

### 12. 封禁用户（管理员）

1. 登录管理员账户
2. 在管理页面找到要封禁的用户
3. 点击"封禁用户"按钮
4. 填写封禁理由和封禁时长
5. 点击"确认封禁"按钮

被封禁用户将：
- 无法在登录页面登录
- 在线用户会收到封禁通知并在10秒后自动退出
- 显示明确的封禁原因和预计解封时间

### 13. 自动添加管理员好友

- 新用户注册后会自动添加名为"Admin"的管理员为好友，无需手动发送请求
- 已注册用户首次登录后会自动添加Admin为好友
- 双向好友关系自动建立，Admin和用户互为好友
- 方便管理员与用户沟通，便于管理和支持

### 14. 撤回消息和文件

#### 14.1 撤回自己发送的消息或文件

- 找到您想要撤回的消息或文件
- 点击消息右下角的菜单图标（三个点）
- 在弹出的菜单中选择"撤回"选项
- 确认撤回操作

#### 14.2 撤回后效果

- 撤回成功后，原消息位置会显示撤回提示："{时间}:您撤回了一条消息"
- 其他用户看到的提示："{时间}:{用户名}撤回了一条消息"
- 撤回的消息和文件将从数据库中删除
- 服务器上的对应文件也会被自动删除

#### 14.3 重新编辑消息

- 消息撤回后，您会看到"重新编辑"蓝色标签
- 点击"重新编辑"标签
- 原消息内容会自动填充到输入框中
- 您可以修改后重新发送

#### 14.4 撤回限制

- 只能撤回2分钟内发送的消息和文件
- 只能撤回自己发送的消息和文件
- 管理员和群主可以撤回群聊中其他成员的消息和文件
- 重新编辑功能仅在撤回后2分钟内可用

---

## 移动端使用说明

### 15. 访问移动端聊天页面

- 使用移动设备访问系统时，系统会自动跳转到移动端聊天页面
- 移动端聊天页面URL：`mobilechat.php`
- 桌面端也可以直接访问`mobilechat.php`查看移动端页面

### 16. 移动端好友管理

#### 16.1 查看好友申请

- 在移动端聊天页面点击右上角的用户头像或菜单按钮
- 在菜单中选择"好友申请"选项
- 查看所有收到的好友申请

#### 16.2 处理好友申请

- 在好友申请列表中，找到要处理的申请
- 点击"同意"按钮接受好友申请
- 点击"拒绝"按钮拒绝好友申请

### 17. 移动端聊天菜单

#### 17.1 好友聊天菜单

- 进入好友聊天页面
- 点击聊天页面右上角的三个点菜单按钮
- 点击"删除好友"选项删除当前好友

#### 17.2 群聊菜单

- 进入群聊页面
- 点击聊天页面右上角的三个点菜单按钮
- 点击"查看成员"选项查看群成员列表
- 点击"退出群聊"选项退出当前群聊

### 18. 移动端群成员操作

- 在群聊菜单中选择"查看成员"选项
- 找到要操作的群成员
- 点击成员后面的三个点菜单按钮
- 点击"发送好友申请"选项向该成员发送好友申请
- 确认发送申请

### 20. 音乐播放器使用说明

#### 20.1 基本操作

- **播放/暂停**：点击播放器中央的播放/暂停按钮
- **上一首**：点击左侧的上一首按钮
- **下一首**：点击右侧的下一首按钮
- **调节音量**：点击音量按钮，然后点击+/-按钮或拖动音量滑块
- **下载歌曲**：点击下载按钮下载当前播放的歌曲
- **切换播放器大小**：点击播放器右上角的+/-按钮

#### 20.2 播放器功能

- **自动播放**：页面加载完成后自动播放歌曲
- **随机播放**：每次播放的歌曲都是随机的
- **自动切歌**：歌曲播放结束后自动播放下一首
- **拖拽功能**：可以拖拽播放器到页面任意位置
- **音量控制**：支持调节音量大小，带有音量图标变化
- **进度显示**：显示当前播放时间和总时长
- **响应式设计**：支持桌面端和移动端

### 21. 移动端其他功能

- 移动端支持发送文本消息和文件
- 移动端支持查看好友在线状态
- 移动端支持搜索好友
- 移动端支持提交反馈
- 移动端支持扫码登录PC端
- 移动端支持消息撤回和重新编辑
- 移动端支持音乐播放器功能

### 22. 在线更新系统

#### 22.1 访问更新页面

- 管理员登录后，可以通过访问 `updata.php` 页面进入在线更新系统
- 只有管理员才能访问此页面

#### 22.2 查看更新信息

- 系统会自动连接到更新服务器，获取最新版本信息
- 显示当前版本和最新版本对比
- 显示更新内容和待更新文件列表

#### 22.3 执行更新

- 点击"立即更新"按钮开始下载和安装更新
- 系统会自动备份当前文件到 `old/` 目录
- 自动下载并替换需要更新的文件
- 显示更新成功或失败的文件数量

#### 22.4 撤销更新

- 如果更新后出现问题，可以点击"撤销更新"按钮恢复到更新前的版本
- 系统会从 `old/` 目录恢复备份的文件
- 撤销更新后，当前版本会恢复到更新前的状态

#### 22.5 更新注意事项

- 请确保服务器有足够的磁盘空间
- 更新过程中不要关闭浏览器
- 建议在更新前备份重要数据
- 更新后可能需要清除浏览器缓存

---

## 安全说明

- 密码使用 PHP 内置的 `password_hash()` 函数进行哈希存储
- 使用 PDO 预处理语句防止 SQL 注入
- 文件上传经过严格的类型和大小验证
- 错误信息不包含敏感内容

## 浏览器支持

- Chrome (推荐)
- Firefox
- Safari
- Edge
- via
- 主流浏览器
- 声明 : 请确保系统和浏览器支持网页功能否则将导致部分功能不可用，Windows：推荐使用Windows7 64位等以上版本系统 Linux：无限制 android：无限制 IOS：无限制
## 许可证
MIT License
